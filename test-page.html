<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>メルカリ風テストページ - 出品商品一覧</title>
    <style>
        body {
            font-family: 'Hiragino Sans', 'ヒラギノ角ゴ ProN W3', 'Hiragino Kaku Gothic ProN', 'メイリオ', Meiryo, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .item-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .item-box {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .item-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .item-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }
        
        .item-info {
            padding: 15px;
        }
        
        .item-name {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .item-price {
            font-size: 18px;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 5px;
        }
        
        .item-status {
            font-size: 12px;
            color: #666;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .controls button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .controls button:hover {
            background: #ff5252;
        }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📦 メルカリ風テストページ - 出品商品一覧</h1>
        <p>Chrome拡張機能のテスト用ページです</p>
    </div>
    
    <div class="controls">
        <h3>🔧 テスト用コントロール</h3>
        <button onclick="simulateProductScan()">商品スキャンをテスト</button>
        <button onclick="addRandomProduct()">ランダム商品を追加</button>
        <button onclick="clearProducts()">商品をクリア</button>
        <button onclick="showDebugInfo()">デバッグ情報を表示</button>
    </div>
    
    <div class="item-grid" id="itemGrid">
        <!-- 商品アイテムがここに表示されます -->
    </div>
    
    <div class="debug-info" id="debugInfo" style="display: none;">
        <h4>🐛 デバッグ情報</h4>
        <div id="debugContent"></div>
    </div>

    <script>
        // サンプル商品データ
        const sampleProducts = [
            { name: 'iPhone 13 Pro 128GB シルバー', price: 85000, status: '出品中' },
            { name: 'Nintendo Switch 本体 ネオンブルー/ネオンレッド', price: 28000, status: '出品中' },
            { name: 'AirPods Pro 第2世代 MQD83J/A', price: 25000, status: '出品中' },
            { name: 'ルイヴィトン モノグラム ハンドバッグ', price: 45000, status: '出品中' },
            { name: 'ナイキ エアジョーダン 1 27cm', price: 18000, status: '出品中' },
            { name: 'MacBook Air M2 13インチ 256GB', price: 120000, status: '出品中' },
            { name: 'プレイステーション5 本体', price: 55000, status: '出品中' },
            { name: 'ロレックス サブマリーナ（レプリカ）', price: 8000, status: '出品中' }
        ];
        
        let currentProducts = [];
        
        // 初期商品を表示
        function initializeProducts() {
            currentProducts = [...sampleProducts];
            renderProducts();
        }
        
        // 商品を画面に描画
        function renderProducts() {
            const grid = document.getElementById('itemGrid');
            grid.innerHTML = '';
            
            currentProducts.forEach((product, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item-box';
                itemElement.setAttribute('data-testid', 'item-cell');
                
                itemElement.innerHTML = `
                    <a href="/items/product_${index + 1}" style="text-decoration: none; color: inherit;">
                        <div class="item-image">商品画像</div>
                        <div class="item-info">
                            <div class="item-name" data-testid="item-name">${product.name}</div>
                            <div class="item-price" data-testid="item-price">¥${product.price.toLocaleString()}</div>
                            <div class="item-status">${product.status}</div>
                        </div>
                    </a>
                `;
                
                grid.appendChild(itemElement);
            });
            
            updateDebugInfo();
        }
        
        // 商品スキャンのシミュレーション
        function simulateProductScan() {
            console.log('商品スキャンを開始...');
            
            // Chrome拡張機能のcontent scriptが存在する場合
            if (typeof scanProducts === 'function') {
                scanProducts();
            } else {
                console.log('Chrome拡張機能のcontent scriptが読み込まれていません');
                alert('Chrome拡張機能を有効にしてからテストしてください');
            }
        }
        
        // ランダム商品を追加
        function addRandomProduct() {
            const randomNames = [
                'ランダム商品 A',
                'テスト用アイテム B',
                'サンプル商品 C',
                'デモ用品 D',
                'テスト商品 E'
            ];
            
            const randomProduct = {
                name: randomNames[Math.floor(Math.random() * randomNames.length)] + ` #${Date.now()}`,
                price: Math.floor(Math.random() * 50000) + 1000,
                status: '出品中'
            };
            
            currentProducts.push(randomProduct);
            renderProducts();
        }
        
        // 商品をクリア
        function clearProducts() {
            currentProducts = [];
            renderProducts();
        }
        
        // デバッグ情報を表示
        function showDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            const isVisible = debugDiv.style.display !== 'none';
            debugDiv.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                updateDebugInfo();
            }
        }
        
        // デバッグ情報を更新
        function updateDebugInfo() {
            const debugContent = document.getElementById('debugContent');
            const productElements = document.querySelectorAll('[data-testid="item-cell"]');
            
            debugContent.innerHTML = `
                <p><strong>商品数:</strong> ${currentProducts.length}</p>
                <p><strong>DOM要素数:</strong> ${productElements.length}</p>
                <p><strong>拡張機能の状態:</strong> ${typeof chrome !== 'undefined' && chrome.runtime ? '有効' : '無効'}</p>
                <p><strong>Content Script:</strong> ${typeof scanProducts === 'function' ? '読み込み済み' : '未読み込み'}</p>
                <p><strong>現在時刻:</strong> ${new Date().toLocaleString()}</p>
                <hr>
                <p><strong>商品リスト:</strong></p>
                <ul>
                    ${currentProducts.map((p, i) => `<li>${i + 1}. ${p.name} - ¥${p.price.toLocaleString()}</li>`).join('')}
                </ul>
            `;
        }
        
        // ページ読み込み時に初期化
        document.addEventListener('DOMContentLoaded', initializeProducts);
        
        // 拡張機能からのメッセージを受信（テスト用）
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
                console.log('テストページがメッセージを受信:', request);
                
                if (request.action === 'getProducts') {
                    sendResponse({ products: currentProducts });
                }
                
                return true;
            });
        }
        
        // コンソールにヘルプメッセージを表示
        console.log(`
🚀 メルカリ価格調整拡張機能 - テストページ
        
利用可能な関数:
- simulateProductScan() : 商品スキャンをテスト
- addRandomProduct() : ランダム商品を追加
- clearProducts() : 商品をクリア
- showDebugInfo() : デバッグ情報の表示/非表示
        
Chrome拡張機能を有効にしてからテストしてください。
        `);
    </script>
</body>
</html>
